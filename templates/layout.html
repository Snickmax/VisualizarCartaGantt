<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gantt de Proyecto</title>

  <!-- Setear tema lo antes posible para evitar parpadeo -->
  <script>
    (function(){
      try {
        const KEY = 'ui-theme';
        const saved = localStorage.getItem(KEY);
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      } catch(e) {}
    })();
  </script>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>Carta Gantt Interactiva</h1>
    <!-- Toggle de tema -->
    <button id="themeToggle" class="theme-toggle" type="button" aria-label="Cambiar tema">
      <span class="sun">☀️ Claro</span>
      <span class="moon">🌙 Oscuro</span>
    </button>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-wrap">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <div class="foot-left">
      <small>Hecho con Flask + Plotly.js — © 2025 Victor Ibarra</small>
    </div>

    <div class="foot-right">
      <a
        class="btn-linkedin"
        href="https://www.linkedin.com/in/victor-ibarra-espinoza-7a90912a7"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="LinkedIn de Victor Ibarra"
        title="LinkedIn de Victor Ibarra"
      >
        <!-- Icono SVG LinkedIn -->
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.5 8h4V23h-4V8zm7.5 0h3.8v2.05h.05c.53-1 1.83-2.05 3.77-2.05 4.03 0 4.78 2.65 4.78 6.09V23h-4v-6.64c0-1.58-.03-3.6-2.2-3.6-2.2 0-2.53 1.72-2.53 3.49V23h-4V8z"/>
        </svg>
        <span class="label">LinkedIn</span>
      </a>
    </div>
  </footer>

  <!-- Script del toggle de tema (y ajuste de colores en Plotly) -->
  <script>
    (function(){
      const KEY = 'ui-theme';
      const root = document.documentElement;

      function setTheme(t){
        root.setAttribute('data-theme', t);
        try { localStorage.setItem(KEY, t); } catch(e){}
        // Ajustar colores del gráfico si existe
        if (window.Plotly && document.getElementById('gantt')) {
          const cs = getComputedStyle(document.body);
          const bg = cs.getPropertyValue('--card-bg').trim() || 'transparent';
          const fg = cs.getPropertyValue('--text').trim() || '#000';
          try {
            Plotly.relayout('gantt', {
              'paper_bgcolor': bg,
              'plot_bgcolor': bg,
              'font.color': fg
            });
          } catch(e){}
        }
      }

      const btn = document.getElementById('themeToggle');
      if (btn) {
        btn.addEventListener('click', () => {
          const cur = root.getAttribute('data-theme') || 'light';
          setTheme(cur === 'dark' ? 'light' : 'dark');
        });
      }
    })();
  </script>
</body>
</html>
